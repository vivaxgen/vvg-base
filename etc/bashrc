

# -- base activation source script from install/base.sh --
# -- [https://github.com/vivaxgen/install] --

# required environment variables
#   VVG_BASEDIR
#   uMAMBA_ENVNAME

# optional environment variables
#   VVG_PROMPT

PATH=${VVG_BASEDIR}/bin:${PATH}
export APPTAINER_DIR=${VVG_BASEDIR}/opt/apptainer

if [[ -z ${MAMBA_ROOT_PREFIX:-} ]]; then
  export MAMBA_ROOT_PREFIX=${VVG_BASEDIR}/opt/umamba
fi
eval "$(micromamba shell hook -s posix)"
micromamba activate ${uMAMBA_ENVNAME}

# from this point, readlink and dirname are already available

_script="$(readlink -f ${BASH_SOURCE[0]})"

# Delete last component from $_script
_mydir="$(dirname $_script)"

# add VVGBIN rather than adding to path, to minimize name collision
export VVGBIN="$(dirname $_mydir)/bin"

function reload_vvg_profiles {
  for rc in ${VVG_BASEDIR}/etc/bashrc.d/*; do
    if [ -f "$rc" ]; then
        . "$rc"
    fi
  done
  unset rc
  return 0
}

reload_vvg_profiles

# modify PS1 and HISTFILE 

if [ ! -z ${VVG_PROMPT:-} ]; then
    PROMPT=${VVG_PROMPT}

    PS1="(${PROMPT}) [\u@\h \W]\$ "
else
    PROMPT=${uMAMBA_ENVNAME}
fi

export HISTFILE="${HOME}/.bash_history.${PROMPT}"

HISTSIZE=20000
HISTFILESIZE=20000
history -c; history -r

# EOF
